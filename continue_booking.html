<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>Perintis Studio - Official Website</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<meta content="A fully featured admin theme which can be used to build CRM, CMS, etc." name="description" />
	<meta content="Coderthemes" name="author" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />

	<!-- App favicon -->
	<link rel="shortcut icon" href="assets/images/favicon.png">

	<!-- App css -->
	<link href="assets/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
	<link href="assets/css/icons.css" rel="stylesheet" type="text/css" />
	<link href="assets/css/style.css" rel="stylesheet" type="text/css" />

	<!-- Plugins css-->
	<link href="plugins/bootstrap-tagsinput/css/bootstrap-tagsinput.css" rel="stylesheet" />
	<link href="plugins/bootstrap-touchspin/css/jquery.bootstrap-touchspin.min.css" rel="stylesheet" />
	<link href="plugins/bootstrap-select/css/bootstrap-select.min.css" rel="stylesheet" />
	<link href="plugins/select2/css/select2.min.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="plugins/switchery/switchery.min.css">

	<!-- Bootstrap fileupload css -->
	<link href="plugins/bootstrap-fileupload/bootstrap-fileupload.css" rel="stylesheet" />

	<!-- Date Picker -->
	<link href="plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.css" rel="stylesheet" />
	<link href="plugins/glyphicons/glyphicon-bootstrap.css" rel="stylesheet" />

	<!-- Toastr css -->
	<link href="plugins/jquery-toastr/jquery.toast.min.css" rel="stylesheet" />

	<!-- Sweet Alert css -->
	<link href="plugins/sweet-alert/sweetalert2.min.css" rel="stylesheet" type="text/css" />

	<script src="assets/js/modernizr.min.js"></script>


	<style type="text/css" media="screen and (min-width:960px)">
		html {
			scroll-behavior: smooth;
		}

		body {
			overflow: hidden;

			/* overflow-x: hidden; */
		}

		.fullbg {
			background: linear-gradient(to top, #B5B5B5, #B5B5B5);
		}

		@keyframes fadeInUp {
			0% {
				transform: translateY(100%);
				opacity: 0;
			}

			100% {
				transform: translateY(0%);
				opacity: 1;
			}
		}

		.fadeInUp-animation {
			animation: 1.5s fadeInUp;
		}

		@keyframes fadeInBottom {
			100% {
				transform: translateX(0%);
				opacity: 1;
			}

			0% {
				transform: translateX(100%);
				opacity: 0;
			}
		}

		.fadeInBottom-animation {
			animation: 1.5s fadeInBottom;
		}

		div.card-box.responsive-height {
			height: 100vh;
			color: black;
		}
	</style>

	<style>
		@media (max-width: 480px) {
			div.card-box.responsive-height {
				height: 100%;
				margin-bottom: 0px;
			}
		}

		.timeSelection-active {
			background-color: #337ab7 !important;
			color: #fff !important;
			text-shadow: 0 -1px 0 rgba(0, 0, 0, 0.25) !important;
		}

		.disabledTime {
			color: #ccc;
			cursor: initial !important;
		}
	</style>

</head>


<body class="fullbg">
	<!-- ***** Preloader Start ***** -->
	<div id="js-preloader" class="js-preloader">
		<div class="preloader-inner">
			<span class="dot"></span>
			<div class="dots">
				<span></span>
				<span></span>
				<span></span>
			</div>
		</div>
	</div>
	<!-- ***** Preloader End ***** -->
	<!-- HOME -->
	<div class="row" id="ContinueBooking">
		<div class="col-sm-6 text-center  ">
			<div class="account-logo-box">
				<img src="assets/images/favicon.png" alt="" width="200" class="logo-large img-fluid fadeInUp-animation">
			</div>
			<div class="account-logo-box">
				<img src="assets/images/image-bg1.png"
					style="width:550px;background-repeat:no-repeat;background-origin: content-box"
					class="img-fluid fadeInUp-animation" alt="">
			</div>
			<div class="row mb-4 pb-4 mt-4 mt-md-1" style="margin-top:2px">
				<div class="col-sm-12 text-center">
					<a href="https://perintisstudio.com/" class="text-dark m-l-5"><img
							src="assets/images/circle-left-solid.svg" alt="" width="25"><b>&nbsp Back to Home</b></a>
				</div>
			</div>
		</div>
		<div class="col-sm-6">
			<div class="card-box responsive-height" style="overflow-y: auto;">
				<div class="account-logo-box" style="background: linear-gradient(to top, black,black)">
					<div class="text-center">
						<p style="color:#ffffff;margin-top:-20px;margin-bottom:30px"><b>
								<label id="lblHeader" class="h4 text-center">
								</label></b></p>
						<p style="color:#ffffff;margin-top:-40px"><label id="lblSubHeader"
								style="font-family:monospace;color:#ffffff" /></p>
					</div>
				</div>
				<div class="account-content p-1" id="content1" style="margin-top:20px">

					<div class="form-group row  m-b-20">
						<div class="col-3 col-md-2"></div>
						<div class="col-12 col-md-8">
							<small for="nameInput"><span>Masukan Nama Anda!</span></small><small
								class="text-danger"><span> *</span></small>
							<div id="nameVal" class="modalPanah modalCustom"></div>
							<input class="form-control" type="text" id="nameInput" required=""
								placeholder="Nama Customer">
						</div>
						<div class="col-3 col-md-2"></div>
					</div>
					<div class="form-group row m-b-20">
						<div class="col-3 col-md-2"></div>
						<div class="col-12 col-md-8">
							<small for="waNumberInput">Masukkan Nomor Whatsapp Anda!</small><small
								class="text-danger"><span> *</span></small>
							<div id="WAVal" class="modalPanah modalCustom"></div>
							<input class="form-control" type="text" id="waNumberInput" required=""
								placeholder="Isi Nomor WA anda" maxlength="15"
								onkeypress='return $.common.isNumberKey(event)'>
						</div>
						<div class="col-3 col-md-2"></div>
					</div>
					<div class="form-group row m-b-20">
						<div class="col-md-2 col-0"></div>
						<div class="col-md-4 col-6">
							<small for="numberofPersonInput">Pilih Jumlah Orang</small><small class="text-danger"><span>
									*</span></small>
							<div id="numberPersonVal" class="modalPanah modalCustom"></div>
							<select class="form-control select2" id="ddlNumberofPersonInput">
								<option value="" selected>--Jumlah Orang--</option>
								<option value="1-7">1 - 7 Orang</option>
								<option value="8-15">8 - 15 Orang</option>
								<option value="16-30">16 - 30 Orang</option>
							</select>
							<small><i>Isi jumlah orang yang akan difoto</i></small>
						</div>
						<div class="col-md-4 col-6">
							<small for="numberofClothesInput">pilih Jumlah Baju</small><small class="text-danger"><span>
									*</span></small>
							<div id="numberClothesVal" class="modalPanah modalCustom"></div>
							<select class="form-control select2" id="ddlNumberofClothesInput">
								<option value="" selected>--Tema Baju--</option>
								<option value="1-2">1 - 2 Baju</option>
								<option value="3+">3 + Baju</option>
							</select>
							<small><i>Isi jumlah tema baju</i></small>
						</div>
						<div class="col-md-2 col-0"></div>
					</div>
					<div class="form-group row m-b-20">
						<div class="col-3 col-md-2"></div>
						<div class="col-12 col-md-8">
							<small for="ddlPhotoThemeInput">Tema Foto</small><small class="text-danger"><span>
									*</span></small>
							<div id="photoThemeVal" class="modalPanah modalCustom"></div>
							<select class="form-control select2" id="ddlPhotoThemeInput">
								<option value="" selected>---Pilih tema foto---</option>
								<option value="Couple">Couple</option>
								<option value="Family">Family</option>
								<option value="Group">Group</option>
								<option value="Graduation">Graduation / Wisuda</option>
								<option value="Maternity">Maternity</option>
								<!-- <option value="Nature">Nature</option> -->
								<option value="Pass Photo">Pass Foto</option>
								<option value="Pre-Wedding">Pre-Wedding</option>
								<option value="Produk">Produk</option>
								<option value="Pesta Ulang Tahun">Foto Ulang Tahun</option>
								<!-- <option value="Piknik">Piknik</option> -->
								<option value="Session">Pers. Session</option>
								<!-- <option value="Touring">Touring</option>  -->
								<option value="Post Wedding">Post Wedding</option>
								<option value="Foto OOTD">Foto OOTD</option>
								<option value="Foto Lainnya">Foto Lainnya</option>
							</select>
						</div>
						<div class="col-3 col-md-2"></div>
					</div>
					<div class="form-group row m-b-20">
						<div class="col-3 col-md-2"></div>
						<div class="col-12 col-md-8">
							<small for="additionalNoteInput">Catatan Tambahan</small>
							<input class="form-control" id="additionalNoteInput" rows="5"
								placeholder="Isi detail tambahan">
						</div>
						<div class="col-3 col-md-2"></div>
					</div>
					<div class="form-group row text-center">
						<div class="col-12">
							<button type="button" id="btnContinue"
								class="btn btn-outline-primary btn-rounded waves-light waves-effect w-md">Continue</button>
						</div>
					</div>
				</div>

				<div class="account-content" id="content2" style="margin-top:20px">
					<div class="form-group row">
						<div class="col-1 col-sm-1 col-md-2"></div>
						<div class="col-10 col-sm-10 col-md-8">
							<small class="d-block text-center">Pilih Tanggal Pelaksanaan<span class="text-danger">
									*</span></small>
							<div id="datePickerValidation" class="modalPanah modalCustom"></div>
							<div class="d-flex align-items-top justify-content-center">
								<div id="datePicker2" class="border p-1 w-100" style="border-radius: 6px;">
								</div>
							</div>
						</div>
						<div class="col-1 col-sm-1 col-md-2"></div>
					</div>

					<div class="form-group row mx-1">
						<div class="col-1 col-sm-1 col-md-2"></div>
						<div class="col-10 col-sm-10 col-md-8">
							<div class="w-100">
								<small class="w-100 d-block text-center">Pilih Jam Pelaksanaan<span class="text-danger">
										*</span></small>
								<div id="timePickerValidation" class="modalPanah modalCustom"></div>
								<div class="row border border-right-0 border-bottom-0 text-center" id="timeSelection">
								</div>
							</div>
						</div>
						<div class="col-1 col-sm-1 col-md-2"></div>
					</div>

					<div class="form-group row m-b-20">
						<div class="col-1 col-sm-1 col-md-2"></div>
						<div class="col-10 col-sm-10 col-md-8">
							<small for="durationInput">Durasi</small><small class="text-danger"><span> *</span></small>
							<div id="durationVal" class="modalPanah modalCustom"></div>
							<select class="form-control select2" id="ddlDurationInput">
							</select>
							<small><i><label id="lblDescDuration" style="font-size:10px"></label></i></small>
						</div>
						<div class="col-1 col-sm-1 col-md-2"></div>
					</div>

					<div class="form-group row text-center">
						<div class="col-12">
							<a href="#" id="btnBack" class="text-dark m-l-5"><img
									src="assets/images/circle-left-solid.svg" alt="" width="35"></a>&nbsp;&nbsp;
							<button type="button" id="btnSave"
								class="btn btn-outline-primary btn-rounded waves-light waves-effect w-md">Submit</button>
						</div>
					</div>
					<div class="card-box">
						<div class="form-group row">
							<div class="col-sm-12 text-center">
								<a style="font-size:12px">* Biaya Booking 50rb Per 1 Jam Sesi Foto, Charge Per 1 Jam
									Berikutnya 100.000</a>
							</div>
							<div class="col-sm-6">
								<a style="font-size:12px">- 1 Jam Sesi = Rp. 50.000</a></br>
								<a style="font-size:12px">- 2 Jam Sesi = Rp. 150.000 (Charge 1 Jam Rp. 100.000)
								</a></br>
								<a style="font-size:12px">- 3 Jam Sesi = Rp. 250.000 (Charge 2 Jam Rp. 100.000 × 2 =
									200.000)</a></br>
								<a style="font-size:12px">- 4 Jam Sesi = Rp. 350.000 (Charge 3 Jam Rp. 100.000 × 3 =
									300.000)</a>
							</div>
							<div class="col-sm-6">
								<a style="font-size:12px">- 5 Jam Sesi = Rp. 450.000 (Charge 4 Jam Rp. 100.000 × 4 =
									400.000)</a></br>
								<a style="font-size:12px">- 6 Jam Sesi = Rp. 550.000 (Charge 5 Jam Rp. 100.000 × 5 =
									500.000)</a>
							</div>
						</div>
					</div>
				</div>
				<div class="row" id="content3">
					<div class="col-sm-6">
						<div class="account-box" style="border-radius:30px;margin-top:-5px">
							<div class="account-content">
								<div class="row">
									<div class="col-md-12">
										<div class="table-responsive">
											<table style="border:none">
												<tbody>
													<tr>
														<td>
															<b>Booking ID -</b>
															<label id="lblBookingID"></label>
															<label id="lblPhoneNumber" style="display: none;"></label>
														</td>
													</tr>
													<tr>
														<td>
															<b>Nama</b> <br />
															<label id="lblName"></label>
														</td>
													</tr>
													<tr>
														<td>
															<b>Jumlah Orang dan Baju</b> <br />
															<label id="lblNumberOfPerson"></label> Orang dan <label
																id="lblNumberOfClothes"></label> Tema Baju
														</td>
													</tr>
													<tr>
														<td>
															<b>Tema</b> <br />
															<label id="lblTheme"></label>
														</td>
													</tr>
													<tr>
														<td>
															<b>Note</b> <br />
															<label id="lblNote"></label>
														</td>
													</tr>
													<tr>
														<td>
															<b>Appointment</b> <br />
															<label id="lblAppointment"></label>
															<label id="lblBookingDate" style="display: none;"></label>
															<label id="lblBookingHour" style="display: none;"></label>
															<label id="lblDuration" style="display: none;"></label>
														</td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-sm-6 text-center" style="margin-top:40px">
						<a style="font-size:15px">TRANSFER BOOKING FEE <br>SEBESAR : </a>
						<a style="font-size:15px"><b>Rp <label id="lblBookingFee"
									style="font-size:20px"></label></b><br></a>
						<a style="font-size:15px"><b>7005233534</b><br></h5>
							<a style="font-size:15px"><img src="assets/images/logo-bca.png" alt=""
									style="width:15px">&nbsp; Bank BCA A/N Khaerul Anwar</a>
							<div class="fileupload fileupload-new" data-provides="fileupload" style="margin-top: 20px;">
								<div class="fileupload-new thumbnail" style="width: 170px; height: 120px;">
									<img src="assets/images/small/img-1.jpg" id="image_upload" alt="image" />
								</div>
								<div class="fileupload-preview fileupload-exists thumbnail"
									style="max-width: 170px; max-height: 120px; line-height: 20px;"></div>
								<br>
								<button type="button" class="btn btn-outline-primary btn-rounded btn-file"
									style="width: 80px;">
									<span class="fileupload-new"><i class="fa fa-paper-clip"></i> Unggah</span>
									<span class="fileupload-exists"><i class="fa fa-undo"></i> Ubah</span>
									<input type="file" accept="image/*" class="btn-secondary" id="fileInput"
										onchange="Image_Upload(event)" />
								</button>
								<button class="btn btn-outline-primary btn-rounded waves-light waves-effect"
									id="btnSend" style="width: 80px;">Kirim</button>
							</div>
					</div>
				</div>
				<div class="form-group row" id="Confirmation">
					<div class="col-12">
						<small class="form-text text-muted">
							<i>Note : <br />Transfer sesuai dengan nominal booking ke nomor rekening yang diberikan.
								Jika sudah, unggah bukti pembayaran agar data anda tersimpan </i>
						</small>
					</div>
					<div class="col-7 text-center" style="margin-top:-30px">

						<!-- <a class="btn btn-outline-primary btn-rounded waves-light waves-effect w-md" href="http://api.whatsapp.com/send?phone=6282310295366"> Konfirmasi Pembayaran</a>  -->
					</div>
				</div>
				<!-- end card-box-->
				<!-- end wrapper -->
			</div>
		</div>
		<div id="loaderModal" class="modal" tabindex="-1" role="dialog" aria-hidden="true" style="display: none;">
			<div class="mask">
				<div class="mask-inner">
					<br />
					<br />
					<br />
					<br />
					<br />
					<br />
					<br />
					<br />
					<br />
					<br />
					<br />
					<br />
					<div class="loader" style="text-align:center">
						<img src="assets/images/loader.gif" width="80px" alt="..." />
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- END HOME -->


	<!-- Footer -->
	<!-- <footer class="footer">
		<div class="container">
			<div class="row">  
				<div class="col-12 text-center">
					© Copyright 2023 Perintis Studio. All Rights Reserved.
				</div>
			</div>
		</div>
	</footer> -->
	<!-- End Footer -->

	<!-- jQuery  -->
	<script src="assets/js/jquery.min.js"></script>
	<script src="assets/js/popper.min.js"></script>
	<script src="assets/js/bootstrap.min.js"></script>
	<script src="assets/js/waves.js"></script>
	<script src="assets/js/jquery.slimscroll.js"></script>

	<!-- App js -->
	<script src="assets/js/jquery.core.js"></script>
	<script src="assets/js/jquery.app.js"></script>

	<!-- Select2 -->
	<script src="plugins/switchery/switchery.min.js"></script>
	<script src="plugins/bootstrap-tagsinput/js/bootstrap-tagsinput.min.js"></script>
	<script src="plugins/select2/js/select2.min.js" type="text/javascript"></script>
	<script src="plugins/bootstrap-select/js/bootstrap-select.js" type="text/javascript"></script>
	<script src="plugins/bootstrap-filestyle/js/bootstrap-filestyle.min.js" type="text/javascript"></script>
	<script src="plugins/bootstrap-touchspin/js/jquery.bootstrap-touchspin.min.js" type="text/javascript"></script>
	<script src="plugins/bootstrap-maxlength/bootstrap-maxlength.js" type="text/javascript"></script>
	<script type="text/javascript" src="plugins/bootstrap-datetimepicker/moment.min.js"></script>
	<script type="text/javascript" src="plugins/bootstrap-datetimepicker/collapse.js"></script>
	<script type="text/javascript" src="plugins/bootstrap-datetimepicker/transition.js"></script>
	<script type="text/javascript" src="plugins/bootstrap-datetimepicker/bootstrap-datetimepicker.min.js"></script>

	<!-- Sweet Alert Js  -->
	<script src="plugins/sweet-alert/sweetalert2.min.js"></script>

	<!-- Toastr js -->
	<script src="plugins/jquery-toastr/jquery.toast.min.js" type="text/javascript"></script>

	<script type="module">
		// Import the functions you need from the SDKs you need
		import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
		import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-analytics.js";
		import { getDatabase, ref, set, get, onValue, query, orderByChild, update, equalTo } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-database.js";
		// TODO: Add SDKs for Firebase products that you want to use
		// https://firebase.google.com/docs/web/setup#available-libraries

		// Your web app's Firebase configuration
		// For Firebase JS SDK v7.20.0 and later, measurementId is optional
		const firebaseConfig = {
			apiKey: "AIzaSyC8HMmGwzHeRMI5L-BD3DgSW1TOJq8Rm9Y",
			authDomain: "perintisstudio-cff0f.firebaseapp.com",
			databaseURL: "https://perintisstudio-cff0f-default-rtdb.firebaseio.com",
			projectId: "perintisstudio-cff0f",
			storageBucket: "perintisstudio-cff0f.appspot.com",
			messagingSenderId: "868904587169",
			appId: "1:868904587169:web:122e59af2e4b1391ac45e0",
			measurementId: "G-ZWJ47L64CQ"
		};
		// Initialize Firebase
		const app = initializeApp(firebaseConfig);
		const analytics = getAnalytics(app);
		const database = getDatabase(app);
		const databaseSaveImg = getDatabase(app);

		var _notes = "";
		var _bookTime = "";
		var _duration = "";
		var Allow = "";
		var isSendImage = false;
		var rangeHour = [];
		var disabledTimes = [];
		var bookings = [];
		var times = [10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21];
		var seletedDateSchedule = initDatePicker();
		var seletedTimeSchedule = null;

		var options2 = {
			format: 'DD MMMM YYYY',
			collapse: false,
			ignoreReadonly: true,
			minDate: new Date(),
			disabledDates: [new Date(-1)],
			inline: true,
			defaultDate: new Date()
		};



		function isToday(date) {
			const today = new Date();

			// Get the current date components
			const todayYear = today.getFullYear();
			const todayMonth = today.getMonth();
			const todayDate = today.getDate();

			// Get the given date components
			const givenYear = date.getFullYear();
			const givenMonth = date.getMonth();
			const givenDate = date.getDate();

			// Compare the components
			return todayYear === givenYear && todayMonth === givenMonth && todayDate === givenDate;
		}

		$('#datePicker2').datetimepicker(options2);
		$('#datePicker2').on("dp.change", function (event) {
			const selectedDate = event.date?.format("YYYY/MM/DD");
			seletedDateSchedule = selectedDate;
			validateDisabledTime();
			GetDurationByDate(selectedDate);
		});

		initTimeSelection();
		function initTimeSelection() {
			for (let i = 0; i < times.length; i++) {
				document.getElementById('timeSelection').innerHTML += `
					<div role="button" id="timeOption${times[i]}" 
					class="col-3 border border-top-0 border-left-0 p-1" style="cursor: pointer" 
					>${times[i] + ':00'}</div>
				`
			}
		}

		initActiveTimeSelection();
		function initActiveTimeSelection() {
			if (seletedTimeSchedule) {
				const elSelect = document.getElementById(`timeOption${seletedTimeSchedule}`);
				elSelect.classList.add('timeSelection-active');
			}
		}

		listenTimeSelection();
		function listenTimeSelection() {
			for (let i = 0; i < times.length; i++) {
				document.getElementById(`timeOption${times[i]}`).addEventListener('click', (params) => {
					const timeDisabled = disabledTimes.findIndex(val => val == times[i])
					if (timeDisabled == -1) {
						removeSelectionTimeClass();
						document.getElementById(`timeOption${times[i]}`).classList.remove("timeSelection-active");
						const elSelect = document.getElementById(`timeOption${times[i]}`);
						elSelect.classList.add('timeSelection-active');
						seletedTimeSchedule = times[i];
					}
				})
			}
		}

		function removeSelectionTimeClass() {
			for (let i = 0; i < times.length; i++) {
				document.getElementById(`timeOption${times[i]}`).classList.remove("timeSelection-active");
			}
		}

		function initDatePicker() {
			var currentDate = new Date();
			var date = moment(currentDate).format("YYYY/MM/DD");
			return date;
		}

		getBookedData();
		function getBookedData() {
			const bookingsRef = ref(database, '/Booking');
			bookings = [];
			onValue(bookingsRef, (snapshot) => {
				var booking;
				snapshot.forEach((childSnapshot) => {
					booking = childSnapshot.val();
					if (booking.IsDeleted == false && booking.IsPaid && booking.Name !== "") {
						bookings.push(booking)
					}
				});
				// init date validation
				validateDisabledTime();
			});
		}

		//inital validation for time
		function validateDisabledTime() {
			getDisabledTimes();
			removeDisableTimeClass();
			disabledTimes.forEach((time) => {
				const element = document.getElementById(`timeOption${time}`);
				element.classList.add('disabledTime');
			});
		}

		function getDisabledTimes() {
			disabledTimes = [];
			var bookedToday = bookings.filter((booked) => booked.BookingDate == seletedDateSchedule);
			bookedToday.forEach((booked) => {
				const time = booked?.BookingTime;
				const timeOnNum = time ? parseInt(time) : null;
				for (let i = 0; i < booked.Duration; i++) {
					disabledTimes.push(timeOnNum + i);
				}
			});
			disabledOnFriday();
			disabledByCurrentTime();
		}

		// disabled times if current time more than time option
		function disabledByCurrentTime() {
			const selectedDate = new Date(seletedDateSchedule);
			const todayDate = new Date();
			const today = isToday(selectedDate);
			if (today) {
				const currentHour = todayDate?.getHours();
				disabledTimes = times.filter(time => time < currentHour);
			}
		}

		// disabled at 12 o'clock on friday
		function disabledOnFriday() {
			const selectedDate = new Date(seletedDateSchedule);
			const isFriday = (selectedDate.getDay() == 5);
			if (isFriday) {
				if ((disabledTimes.findIndex(time => time == 12)) == -1) {
					disabledTimes.push(12)
				}
			}
		}

		function removeDisableTimeClass() {
			for (let i = 0; i < times.length; i++) {
				document.getElementById(`timeOption${times[i]}`).classList.remove("disabledTime");
			}
		}

		function GetDurationByDate(date) {
			var x = 1;
			var pluginArrayArg = [];
			bookings.forEach((booked) => {
				pluginArrayArg.push({
					isPaid: booked?.IsPaid,
					isDeleted: booked?.IsDeleted,
					bookingDate: booked?.BookingDate,
					bookingTime: booked?.BookingTime,
					duration: booked?.Duration
				});
				x++
			});
			var filterArr = pluginArrayArg.filter(function (obj) {
				return obj.bookingDate == date
			});

			var n = 0;
			var hour1 = [];
			var hour2 = [];
			for (var i = 0; i < filterArr.length; i++) {
				var countDuration = parseInt(filterArr[i].duration);
				var hourInterval = parseInt(filterArr[i].bookingTime);
				for (var z = 0; z < countDuration; z++) {
					n = 1;
					var endRange = parseInt(hourInterval) + n;
					rangeHour.push(hourInterval);
					// Find the index of an object with a specific property value
					let index = rangeHour.findIndex((item) => item === endRange);

					// Check if the object with the specified property value exists in the array
					if (index === -1) {
						// If not found, push a new object with the desired properties
						rangeHour.push(endRange);
					} else {
						// If found, log a message indicating that the object already exists
						console.log("Object already exists");
					}


					hourInterval = hourInterval + n;
				}
				n = 0;
			}
		}

		$('#btnSave').click(function () {
			ClearValidation();
			const Newdate = new Date();
			const Bookdate = new Date(seletedDateSchedule);
			var _newdate = moment(Newdate).format('YYYY/MM/DD');

			if (seletedDateSchedule == null || seletedDateSchedule == '') {
				$("#datePickerValidation").show();
				$("#datePickerValidation").html("Tanggal Pelaksanaan wajib diisi");
				return
			}
			else if (seletedTimeSchedule == null || seletedTimeSchedule == '') {
				$("#timePickerValidation").show();
				$("#timePickerValidation").html("Jam Pelaksanaan wajib diisi");
			}
			else if (document.getElementById("ddlDurationInput").value == null || document.getElementById("ddlDurationInput").value == '') {
				$("#durationVal").show();
				$("#durationVal").html("Silahkan isi durasi");
			}
			else {
				isSendImage = false;
				var result = 1;
				var _dbBookingDate = "";
				var _dbMaxBookingTime = "";
				var _dbBetweenTime = "";

				if (seletedDateSchedule == _newdate) {
					// check hour
					const NewHour = new Date();
					var _newhour = moment(NewHour).format('HH');
					if (seletedTimeSchedule < _newhour) {
						$("#timePickerValidation").show();
						$("#timePickerValidation").html("Jam harus lebih besar dari waktu sekarang.");
						result = 0;
					}
					else {
						result = 1;
					}
				}

				if (Boolean(result)) {
					swal({
						title: 'Konfirmasi',
						text: "Anda yakin ingin menyimpan data ini?",
						type: 'warning',
						showCancelButton: true,
						confirmButtonColor: '#4fa7f3',
						cancelButtonColor: '#d57171',
						confirmButtonText: 'OK'
					}).then(function () {
						$("#loaderModal").modal('show');
						var Id = "";
						Id = moment(Bookdate).format('YYYYMMDDHHmmss') + "" + seletedTimeSchedule

						// validation and save data
						Validation(Id, seletedDateSchedule);
						// console.log(Id,_bookdate) 

					});
				}
			}
		});


		function Validation(_id, _bookdate) {
			var x = 1;
			var pluginArrayArg = [];
			var filterArr = [];
			bookings.forEach((booked) => {
				pluginArrayArg.push({
					name: booked.Name,
					id: booked.Id,
					phoneNumber:
						booked.PhoneNumber,
					numberofPerson: booked.NumberofPerson,
					numberofClothes: booked.NumberofClothes,
					theme: booked.Theme, additionalNote:
						booked.AdditionalNote, bookingTime:
						booked.BookingTime,
					bookingDate: booked.BookingDate,
					bookingFee: booked.BookingFee,
					isPaid: booked.IsPaid,
					isDeleted: booked.IsDeleted,
					duration: booked.Duration
				});
				x++
			}, {
				onlyOnce: true
			});
			filterArr = pluginArrayArg.filter(function (obj) {
				return obj.bookingDate == _bookdate && obj.name !== "";
			});
			if (!isSendImage) {
				if (filterArr.length > 0) {

					var Count = filterArr.length;
					var rangeHour = [];
					var rangeHourAction = [];

					var countDurationAction = parseInt(document.getElementById("ddlDurationInput").value);
					var hourIntervalAction = parseInt(seletedTimeSchedule);
					// add interval duration
					var n = 0;
					for (var i = 0; i < Count; i++) {
						var countDuration = parseInt(filterArr[i].duration);
						var hourInterval = parseInt(filterArr[i].bookingTime);
						for (var z = 0; z < countDuration; z++) {
							n = 1;
							var endRange = parseInt(hourInterval) + n;
							rangeHour.push(hourInterval + " - " + endRange);
							hourInterval = hourInterval + n;
						}
						n = 0;

						if (filterArr[i].id == _id) {
							Allow = 0;
						} else {
							Allow = 1
						};

					};

					filterArr = [];
					pluginArrayArg = [];

					for (var z = 0; z < countDurationAction; z++) {
						n = 1;
						var endRangeAction = parseInt(hourIntervalAction) + n;
						rangeHourAction.push(hourIntervalAction + " - " + endRangeAction);
						hourIntervalAction = hourIntervalAction + n;
					}

					// checking rangeHour vs rangeHourAction
					if (rangeHour.some(v => rangeHourAction.indexOf(v) !== -1)) {
						Allow = 0;
					} else {
						Allow = 1;
					};
					if (_id == "") {
						Allow = 3;
					}

					if (Allow == 1) {
						SaveData(_id, _bookdate);
					} else if (Allow == 0) {
						$("#loaderModal").modal('hide');
						_id = "";
						const constBookdate = new Date(seletedDateSchedule);
						// The write failed...
						swal({
							title: 'Alert',
							type: 'error',
							text: 'Tanggal ' + moment(constBookdate).format('DD MMMM YYYY') + ' jam ' + seletedTimeSchedule + ' sudah terisi.',
							showCloseButton: true,
							confirmButtonColor: '#4fa7f3'
						})

						return;
					}
					else {
						console.log('stop process');
					}

				} else {
					Allow = 1;
					SaveData(_id, _bookdate);
				};
			}
		}

		function SaveData(Id, bookdate) {

			const Newdate = new Date();

			if ($('#additionalNoteInput').val() == "") {
				_notes = "Tidak ada note tambahan.";
			}
			else {
				_notes = $('#additionalNoteInput').val();
			}

			set(ref(database, 'Booking/' + Id), {
				Id: Id,
				Name: $('#nameInput').val(),
				PhoneNumber: $('#waNumberInput').val(),
				NumberofPerson: document.getElementById("ddlNumberofPersonInput").value,
				NumberofClothes: document.getElementById("ddlNumberofClothesInput").value,
				Theme: document.getElementById("ddlPhotoThemeInput").value,
				AdditionalNote: _notes,
				BookingDate: bookdate,
				BookingFee: '0',
				BookingTime: seletedTimeSchedule,
				Duration: document.getElementById("ddlDurationInput").value,
				CreatedDate: moment(Newdate).format('YYYY/MM/DD HH:mm:ss'),
				IsDeleted: false,
				IsPaid: false,
				PaidOff: '0'
			}).then(() => {
				$("#loaderModal").modal('hide');
				// Data saved successfully!
				swal(
					{
						title: 'Berhasil',
						text: 'Data berhasil disimpan',
						type: 'success',
						confirmButtonColor: '#4fa7f3'
					}
				)
				$("#content1").hide();
				$("#content2").hide();
				$("#content3").show();
				$("#Confirmation").show();
				// get confirm pay
				const starCountRef = ref(database, 'Booking/' + Id);
				onValue(starCountRef, (snapshot) => {
					const data = snapshot.val();
					$("#lblBookingID").html(data.Id);
					$("#lblPhoneNumber").html(data.PhoneNumber);
					$("#lblName").html(data.Name);
					$("#lblNumberOfPerson").html(data.NumberofPerson);
					$("#lblNumberOfClothes").html(data.NumberofClothes);
					$("#lblTheme").html(data.Theme);
					$("#lblNote").html(data.AdditionalNote);
					$("#lblBookingDate").html(data.BookingDate);
					$("#lblBookingHour").html(data.BookingTime);
					$("#lblDuration").html(data.Duration);

					var d = Date.parse(data.BookingDate);
					var substring = moment(d).format('dddd, D MMMM YYYY');
					var subStringArr = substring.split(', ');
					var day = subStringArr[0];
					var dayBahasa = "";
					_bookTime = data.BookingTime;
					_duration = data.Duration;

					if (day == "Sunday") {
						dayBahasa = "Minggu";

						var seletedDate
					}
					else if (day == "Monday") {
						dayBahasa = "Senin";
					} else if (day == "Tuesday") {
						dayBahasa = "Selasa";
					} else if (day == "Wednesday") {
						dayBahasa = "Rabu";
					} else if (day == "Thursday") {
						dayBahasa = "Kamis";
					} else if (day == "Friday") {
						dayBahasa = "Jumat";
					} else {
						dayBahasa = "Sabtu";
					}

					var appointment = dayBahasa + ", " + moment(d).format('D MMMM YYYY') + ", Jam " + data.BookingTime + ", " + data.Duration + " jam sesi.";
					$("#lblAppointment").html(appointment);
					$("#lblDuration").html(data.Duration);

					if (data.Duration == "1") {
						$("#lblBookingFee").html("50.000");
						$("#lblBookingFeeConfirm").html("50.000");
					}
					else if (data.Duration == "2") {
						$("#lblBookingFee").html("150.000");
						$("#lblBookingFeeConfirm").html("150.000");
					}
					else if (data.Duration == "3") {
						$("#lblBookingFee").html("250.000");
						$("#lblBookingFeeConfirm").html("250.000");
					}
					else if (data.Duration == "4") {
						$("#lblBookingFee").html("350.000");
						$("#lblBookingFeeConfirm").html("350.000");
					}
					else if (data.Duration == "5") {
						$("#lblBookingFee").html("450.000");
						$("#lblBookingFeeConfirm").html("450.000");
					}
					else if (data.Duration == "6") {
						$("#lblBookingFee").html("500.000");
						$("#lblBookingFeeConfirm").html("500.000");
					}

					//Clear Text
					document.getElementById("nameInput").value = '';
					document.getElementById("waNumberInput").value = '';
					$("#ddlNumberofPersonInput").val("").trigger('change');
					$("#ddlNumberofClothesInput").val("").trigger('change');
					$("#ddlPhotoThemeInput").val("").trigger('change');
					document.getElementById("additionalNoteInput").value = '';
				});

			})
				.catch((error) => {
					// The write failed...
					swal({
						title: 'Alert',
						type: 'error',
						text: error,
						showCloseButton: true,
						confirmButtonColor: '#4fa7f3'
					})
				});
		}

		$('#btnSend').click(function () {
			if (ImageUpload != 'img-1.jpg' && ImageUpload != "") {
				swal({
					title: 'Konfirmasi',
					text: "Bukti pembayaran akan dikirim, anda yakin?",
					type: 'warning',
					showCancelButton: true,
					confirmButtonColor: '#4fa7f3',
					cancelButtonColor: '#d57171',
					confirmButtonText: 'OK'
				}).then(function () {
					uploadImage();
				});
			}
			else {
				swal({
					title: 'Alert',
					type: 'error',
					text: 'Silahkan unggah bukti pembayaran',
					showCloseButton: true,
					confirmButtonColor: '#4fa7f3'
				})
			}
		})

		function uploadImage() {
			// Get the input element			
			$("#loaderModal").modal('show');
			debugger;
			var fileInputImg = document.getElementById('fileInput');
			var bookId = $('#lblBookingID');
			var txtBookId = bookId.text();
			var lblPhoneNumber = $('#lblPhoneNumber').text();
			var lblName = $('#lblName').text();
			var lblNumberOfPerson = $('#lblNumberOfPerson').text();
			var lblNumberOfClothes = $('#lblNumberOfClothes').text();
			var lblTheme = $('#lblTheme').text();
			var lblNote = $('#lblNote').text();
			var lblBookingDate = $('#lblBookingDate').text();
			var lblBookingHour = $('#lblBookingHour').text();
			var lblDuration = $('#lblDuration').text();

			const Newdate = new Date();

			// Get the selected file
			var file = fileInputImg.files[0];

			// Create a FileReader object
			var reader = new FileReader();
			// Set up the FileReader onload event
			reader.onload = function (e) {
				// Get the data URL of the uploaded file
				var imageDataUrl = e.target.result;
				isSendImage = true;
				set(ref(database, 'Booking/' + txtBookId), {
					Id: txtBookId,
					Name: lblName,
					PhoneNumber: lblPhoneNumber,
					NumberofPerson: lblNumberOfPerson,
					NumberofClothes: lblNumberOfClothes,
					Theme: lblTheme,
					AdditionalNote: lblNote,
					BookingDate: lblBookingDate,
					BookingFee: '0',
					BookingTime: lblBookingHour,
					Duration: lblDuration,
					CreatedDate: moment(Newdate).format('YYYY/MM/DD HH:mm:ss'),
					IsDeleted: false,
					IsPaid: true,
					PaidOff: '0',
					UrlImage: imageDataUrl
				}).then(() => {
					$("#loaderModal").modal('hide');
					// Data saved successfully!
					swal(
						{
							title: 'Berhasil',
							text: 'Bukti transfer berhasil diunggah',
							type: 'success',
							confirmButtonColor: '#4fa7f3'
						}
					).then((isConfirmed) => {
						if (isConfirmed) {
							// The user clicked the "OK" button
							window.open('https://wa.link/tuims4', '_blank');
						}
					});

					return;
				})
					.catch((error) => {
						// The write failed...
						swal({
							title: 'Alert',
							type: 'error',
							text: error,
							showCloseButton: true,
							confirmButtonColor: '#4fa7f3'
						})
						return;
					});


				//UpdatePaid(true, txtBookId, lblName, lblPhoneNumber, lblNumberOfPerson, lblNumberOfClothes, lblTheme, lblNote, lblBookingDate, lblBookingHour, lblDuration, imageDataUrl);
				// Save the data URL to local storage (this is just an example, and it's not the recommended way to handle images)
				//localStorage.setItem(txtBookId, imageDataUrl); 
				// You can perform additional actions here, such as displaying the image or sending it to a server
				console.log('Image uploaded successfully!');
				document.getElementById("btnSend").disabled = true;
			};
			// Read the file as a data URL
			reader.readAsDataURL(file);

		}  
	</script>

	<script src="scripts/booking.js"></script>
	<script src="scripts/common.js"></script>


	<!-- Bootstrap fileupload js -->
	<script src="plugins/bootstrap-fileupload/bootstrap-fileupload.js"></script>
</body>

</html>